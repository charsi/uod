"use strict";function clearLocationInfo(){currentLocationInfo={start_latitude:"",start_longitude:"",end_latitude:"",end_longitude:""}}function clearDriveFactors(){driveFactors={duration:0,distance:0,milage:0,petrol_cost:0,traffic_multiplier:1,distUnits:"kms",milageUnits:"kmpl",currency:"",petrolUsed:0,driveCost:""}}function restMap(){markersArray=[],map=new google.maps.Map(document.getElementById("map"),{center:localLatLang,scrollwheel:!0,zoom:10,mapTypeControl:!1}),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer}function resetEverything(){$("#progressBar").hide(),$("#locationToInput").val(""),$("#locationFromInput").val(""),$("#submitButton").prop("disabled",!1),$("#locationToInput").prop("disabled",!1),$("#locationFromInput").prop("disabled",!1),clearLocationInfo(),clearDriveFactors(),restMap(),refreshMap(),$resultGrid.fadeOut("slow",function(){$inputGrid.fadeIn("slow"),[$uberResultSubDiv,$driveResultSubDiv,$resultDiv,$fromDiv,$toDiv,$fuelSpan].forEach(clearDiv)})}function initAutocomplete(){autocompleteFrom=new google.maps.places.Autocomplete(document.getElementById("locationFromInput"),{types:["geocode"]}),autocompleteFrom.addListener("place_changed",fillFromAddress),autocompleteTo=new google.maps.places.Autocomplete(document.getElementById("locationToInput"),{types:["geocode"]}),autocompleteTo.addListener("place_changed",fillToAddress),geolocate(),resetEverything()}function fillFromAddress(){var t=autocompleteFrom.getPlace();currentLocationInfo.start_latitude=t.geometry.location.lat(),currentLocationInfo.start_longitude=t.geometry.location.lng(),refreshMap()}function fillToAddress(){var t=autocompleteTo.getPlace();currentLocationInfo.end_latitude=t.geometry.location.lat(),currentLocationInfo.end_longitude=t.geometry.location.lng(),refreshMap()}function fromLocationValid(){return""!=currentLocationInfo.start_latitude&&""!=currentLocationInfo.start_longitude&&""!=$("#locationFromInput").val()}function toLocationValid(){return""!=currentLocationInfo.end_latitude&&""!=currentLocationInfo.end_longitude&&""!=$("#locationToInput").val()}function clearOverlays(){for(var t=0;t<markersArray.length;t++)markersArray[t].setMap(null);markersArray.length=0}function refreshMap(){var t=localLatLang;map.setZoom(10);if(fromStr=$("#locationFromInput").val(),toStr=$("#locationToInput").val(),fromLocationValid()&&toLocationValid())clearOverlays(),directionsDisplay.setMap(map),directionsService.route({origin:fromStr,destination:toStr,travelMode:"DRIVING"},function(t,e){"OK"===e?directionsDisplay.setDirections(t):console.log("Directions request failed due to "+e)});else if(fromLocationValid()){t={lat:currentLocationInfo.start_latitude,lng:currentLocationInfo.start_longitude};var e=new google.maps.Marker({position:t,map:map,title:fromStr});markersArray.push(e),map.setZoom(13)}else if(toLocationValid()){t={lat:currentLocationInfo.end_latitude,lng:currentLocationInfo.end_longitude};var e=new google.maps.Marker({position:t,map:map,title:toStr});markersArray.push(e),map.setZoom(13)}map.panTo(t)}function geolocate(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var e={lat:t.coords.latitude,lng:t.coords.longitude},o=new google.maps.Circle({center:e,radius:t.coords.accuracy});autocompleteFrom.setBounds(o.getBounds()),autocompleteTo.setBounds(o.getBounds()),localLatLang.lat=e.lat,localLatLang.lng=e.lng,refreshMap()})}function freezeControls(){$("#submitButton").prop("disabled",!0),$("#locationToInput").prop("disabled",!0),$("#locationFromInput").prop("disabled",!0)}function clearDiv(t){t.empty()}function makeDriveCalculations(t){$.post("/traffic",currentLocationInfo,function(e){console.log(e.multiplier),driveFactors.traffic_multiplier=e.multiplier,driveFactors.petrol_cost=64,driveFactors.milage=14,driveFactors.duration=t.prices[0].duration/60,driveFactors.distance=1.60934*t.prices[0].distance,driveFactors.currency=t.prices[0].estimate.match(/^\D*/),driveFactors.petrolUsed=driveFactors.distance/driveFactors.milage*driveFactors.traffic_multiplier;var o=driveFactors.petrolUsed*driveFactors.petrol_cost;o=driveFactors.currency+(.9*o).toFixed(0)+"-"+(1.1*o).toFixed(0),driveFactors.driveCost=o,refreshDriveInfo(),$inputGrid.fadeOut("slow",function(){$resultGrid.fadeIn("slow");var t=new google.maps.TrafficLayer;t.setMap(map)})})}function changeDriveFactorUnits(t){}function refreshDriveInfo(){var t="";t+='<h5 style="text-align : center;"><br><strong>'+driveFactors.driveCost+"<sup>*<sup></strong></h5>",$driveResultSubDiv.append(t),$fuelSpan.append(driveFactors.petrolUsed.toFixed(2)+" L (petrol)<br>@ "+driveFactors.currency+driveFactors.petrol_cost+" per litre"),$resultDiv.append("<p>Distance: "+driveFactors.distance.toFixed(2)+' kms</p><p><i class="material-icons" id="time-icon">access_time</i> '+driveFactors.duration+" mins</p>")}function createUberHtml(t){var e="";e+='<h5 style="text-align : center;"><br><strong>'+t.prices[0].estimate+"<sup>*<sup></strong></h5>",e+='<p style="text-align : center;">via '+t.prices[0].display_name+"</p>",e+="<hr><small>Other options</small><br>",e+='<table class="mdl-data-table mdl-js-data-table">';var o=t.prices[0].display_name;return $.each(t.prices,function(t,r){r.display_name!=o&&"Metered"!=r.estimate&&(o=r.display_name,e+="<tr><td>"+r.display_name+"</td><td>"+r.estimate+"</td></tr>")}),e+="</table>"}var autocompleteFrom,autocompleteTo,map,directionsService,directionsDisplay,markersArray=[],fromStr,toStr,$uberResultSubDiv=$("#uberResultSubDiv"),$driveResultSubDiv=$("#driveResultSubDiv"),$resultDiv=$("#resultDiv"),$fromDiv=$("#fromDiv"),$toDiv=$("#toDiv"),$inputGrid=$("#inputDiv"),$resultGrid=$("#resultGrid"),$progressBar=$("#progressBar"),$fuelSpan=$("#fuel"),currency_symbols={USD:"$",EUR:"€",CRC:"₡",GBP:"£",ILS:"₪",INR:"₹",JPY:"¥",KRW:"₩",NGN:"₦",PHP:"₱",PLN:"zł",PYG:"₲",THB:"฿",UAH:"₴",VND:"₫"};const key="***REMOVED***";var localLatLang={lat:51.5089254,lng:-.107437},currentLocationInfo={start_latitude:"",start_longitude:"",end_latitude:"",end_longitude:""},driveFactors={duration:0,distance:0,milage:0,petrol_cost:0,traffic_multiplier:1,distUnits:"kms",milageUnits:"kmpl",currency:"",petrolUsed:0,driveCost:""};$resultGrid.hide(),$("#submitButton").click(function(){fromLocationValid()&&toLocationValid()&&(freezeControls(),$progressBar.show(),$.post("/uber",currentLocationInfo,function(t){console.log(t),$fromDiv.append(fromStr),$toDiv.append(toStr),makeDriveCalculations(t);var e=createUberHtml(t);$uberResultSubDiv.append(e)}))}),$("#backButton").click(function(){resetEverything()});